<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infill criteria • mlrMBO</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><meta property="og:title" content="Infill criteria">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">mlrMBO</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/mlrMBO.html">
    <span class="fa fa-bolt"></span>
     
    Quickstart
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/supplementary/mixed_space_optimization.html">Mixed Space Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/noisy_optimization.html">Noisy Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/infill_criteria.html">Infill Criteria</a>
    </li>
    <li>
      <a href="../../articles/supplementary/machine_learning_with_mlrmbo.html">Machine learning with mlrMBO</a>
    </li>
    <li>
      <a href="../../articles/supplementary/human_in_the_loop_MBO.html">Human-in-the-loop MBO</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlrMBO">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Infill criteria</h1>
            
      
      <small>Source: <a href="https://github.com/mlr-org/mlrMBO/blob/master/vignettes/supplementary/infill_criteria.Rmd"><code>vignettes/supplementary/infill_criteria.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>This vignette gives a short example of the usage of the different infill criteria in <code>mlrMBO</code>. The infill criteria plays an important part for the optimization process in MBO as it is responsible for the proposals of new points at each iteration and thus steers the search.</p>
</div>
<div id="infill-criteria" class="section level2">
<h2 class="hasAnchor">
<a href="#infill-criteria" class="anchor"></a>Infill Criteria</h2>
<p>In addition to the most often used <em>Expected Improvement</em>, there are also <em>Confidence Bound</em>, <em>Augmented Expected Improvement</em>, <em>Expected Quantile Improvement</em>, <em>Direct indicator-based Search</em>, the <em>Mean Response</em> and the use of <em>Standard Error</em> implemented. Most criteria take the mean and variance estimate of the surrogate model into account, so that the choice of infill criteria is connected to the choice of the surrogate regression method. It’s also possible to generate custom infill criteria. In the first step we show the general setting for the infill criteria in <code>mlrMBO</code>. In the second step we give two examples with the Expected Improvement and the mean response.</p>
<div id="general-setting-for-the-infill-criterion" class="section level3">
<h3 class="hasAnchor">
<a href="#general-setting-for-the-infill-criterion" class="anchor"></a>General setting for the infill criterion</h3>
<p>To specify which infill criterion should be used, the <code>MBOControl</code> object has to be extended by calling <code><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill()</a></code>. In addition to the criterion you can also set the parameters of the infill criterion optimization. The criterion itself is created with <code>makeMBOInfillCrit*()</code>. The most common infill criteria are predefined like <code>crit.ei</code> and <code>crit.cb2</code>. See <code><a href="../../reference/MBOInfillCrit.html">?MBOInfillCrit</a></code> for details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span>()
ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(ctrl, <span class="dt">iters =</span> 5L)
ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> <span class="kw"><a href="../../reference/infillcrits.html">makeMBOInfillCritEI</a></span>())</code></pre></div>
<p>For infill criteria that use the variance estimation of the surrogate model you need a learner that supports the variance estimate. For the common surrogate regression methods <strong>Kriging</strong> and <strong>Random Forest</strong>, the estimate is supported by setting <code>predict.type = "se"</code> in the learner object. For <strong>Random Forest</strong> there are different variance estimators, like the <strong>jackknife-after-bootstrap</strong> (the default) or the <strong>noisy bootstrap</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn.rf =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">"regr.randomForest"</span>, <span class="dt">predict.type =</span> <span class="st">"se"</span>, <span class="dt">se.method =</span> <span class="st">"jackknife"</span>)</code></pre></div>
</div>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<p>In the following two examples we want to minimize a simple one dimensional test function. First, we will use the <em>mean response</em> and second the <em>Expected Improvement</em> as infill criteria, while leaving the other settings the same.</p>
<div id="mean-response" class="section level4">
<h4 class="hasAnchor">
<a href="#mean-response" class="anchor"></a>Mean Response</h4>
<p>Using the Mean Response as infill criterion leads to proposals of new points at the optimum of the estimated mean of the surrogate model. Hence, in case of minimization, it takes the point of the minimum of the surrogate model and in case of maximization it takes the point of the maximum. For this reason, the focus is on exploitation. It does not take the uncertainty of the surrogate model into account. Because of this, it can happen that only a local optima of the target function will be found. We will see that case in the following example.</p>
<p>In the first step we build a simple test function and generate an initial design:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test.fun =<span class="st"> </span><span class="kw">makeSingleObjectiveFunction</span>(
 <span class="dt">fn =</span> function(x) x *<span class="st"> </span><span class="kw">sin</span>(<span class="dv">14</span> *<span class="st"> </span>x),
 <span class="dt">par.set =</span> <span class="kw">makeNumericParamSet</span>(<span class="dt">lower =</span> <span class="dv">0</span>, <span class="dt">upper =</span> <span class="dv">1</span>, <span class="dt">len =</span> 1L)
)

<span class="kw">set.seed</span>(<span class="dv">4</span>)
design =<span class="st"> </span><span class="kw">generateDesign</span>(4L, <span class="kw">getParamSet</span>(test.fun), <span class="dt">fun =</span> lhs::maximinLHS)</code></pre></div>
<p>In the next step we create a Kriging Learner to be used as the surrogate. Note that normally, we would set <code>predict.type = "se"</code> but as the <strong>mean</strong> as infill criterion does not take the variance estimate into account we do not have to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn.km =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">"regr.km"</span>)</code></pre></div>
<p>Furthermore the control object for the MBO optimization has to be defined. Within <code><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill()</a></code> we have to set <code>crit = makeMBOInfillCritMeanResponse()</code> to choose the mean response as infill criterion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl.mean =<span class="st"> </span><span class="kw"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span>()
ctrl.mean =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(ctrl.mean, <span class="dt">iters =</span> 5L)
ctrl.mean =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl.mean, <span class="dt">crit =</span> <span class="kw"><a href="../../reference/infillcrits.html">makeMBOInfillCritMeanResponse</a></span>())</code></pre></div>
<p>For the optimization run we use <code><a href="../../reference/exampleRun.html">exampleRun()</a></code> instead of <code><a href="../../reference/mbo.html">mbo()</a></code> in order to visualize it with <code><a href="../../reference/plotExampleRun.html">plotExampleRun()</a></code>. As we only want to look at the first and last iteration, we set <code>iters = c(1L, 5L)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">run.mean =<span class="st"> </span><span class="kw"><a href="../../reference/exampleRun.html">exampleRun</a></span>(test.fun, <span class="dt">design =</span> design, <span class="dt">learner =</span> lrn.km, <span class="dt">control =</span> ctrl.mean)
<span class="kw"><a href="../../reference/plotExampleRun.html">plotExampleRun</a></span>(run.mean, <span class="dt">pause =</span> <span class="ot">FALSE</span>, <span class="dt">iters =</span> <span class="kw">c</span>(1L, 5L))</code></pre></div>
<p><img src="infill_criteria_files/figure-html/mean-1.svg" width="672"><img src="infill_criteria_files/figure-html/mean-2.svg" width="672"></p>
<p>In the figures the solid line shows the test function, the dashed line the estimated mean of the surrogate model, the red points the initial design points, green squares further design points and the blue triangles the proposed points. We see that new design points are only proposed at the local optimum. Indeed we are seeing here only five iterations, but the optimization also stagnates with more iterations at the local optimum. This is because new proposals are made always at the minimum of the surrogate model and thus there is no exploration anymore. Let’s try it next with an infill criterion that does exploitation as well as exploration.</p>
</div>
<div id="expected-improvement" class="section level4">
<h4 class="hasAnchor">
<a href="#expected-improvement" class="anchor"></a>Expected Improvement</h4>
<p>The Expected Improvement takes the mean and uncertainty estimate of the surrogate model into account. Roughly speaking, at the design points you have the knowledge about the true values of the target function. The uncertainty is very low in this area. So you expect that you will not reach a large improvement if you search further in this part. Areas with large uncertainty are more interesting because there is a chance to get a larger improvement. However, it is also worth to consider the estimated mean because areas with low mean are more interesting. That’s why the Expected Improvement does both: exploitation and exploration.</p>
<p>We take the same test function as in the first example. Within the learner object we have to set <code>predict.type = "se"</code>, because Expected Improvement requires the variance estimation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn.km =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">"regr.km"</span>, <span class="dt">predict.type =</span> <span class="st">"se"</span>)</code></pre></div>
<p>Now we set <code>crit = makeMBOInfillCritEI()</code> within <code><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl.ei =<span class="st"> </span><span class="kw"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span>()
ctrl.ei =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(ctrl.ei, <span class="dt">iters =</span> 5L)
ctrl.ei =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl.ei, <span class="dt">crit =</span> <span class="kw"><a href="../../reference/infillcrits.html">makeMBOInfillCritEI</a></span>())</code></pre></div>
<p>Again we use <code><a href="../../reference/exampleRun.html">exampleRun()</a></code> instead of mbo to visualize the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">run.ei =<span class="st"> </span><span class="kw"><a href="../../reference/exampleRun.html">exampleRun</a></span>(test.fun, <span class="dt">design =</span> design, <span class="dt">learner =</span> lrn.km, <span class="dt">control =</span> ctrl.ei)
<span class="kw"><a href="../../reference/plotExampleRun.html">plotExampleRun</a></span>(run.ei, <span class="dt">pause =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="infill_criteria_files/figure-html/plotei-1.svg" width="672"><img src="infill_criteria_files/figure-html/plotei-2.svg" width="672"><img src="infill_criteria_files/figure-html/plotei-3.svg" width="672"><img src="infill_criteria_files/figure-html/plotei-4.svg" width="672"><img src="infill_criteria_files/figure-html/plotei-5.svg" width="672"></p>
<p>In the figures the uncertainty is displayed by the shaded area. The lower part of a plot shows the Expected Improvement. Now we found the global optimum of the test function in only five iterations.</p>
<p>This two examples show that exploration can be important to find the global optimum. If the learner supports the variance estimate, <em>Expected Improvement</em> or <em>Confidence Bound</em> is a good choice for the infill criterion.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#infill-criteria">Infill Criteria</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bernd Bischl, Jakob Bossek, Jakob Richter, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
