<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Human-in-the-loop MBO • mlrMBO</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">mlrMBO</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/mlrMBO.html">
    <span class="fa fa-bolt"></span>
     
    Quickstart
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/supplementary/mixed_space_optimization.html">Mixed Space Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/noisy_optimization.html">Noisy Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/infill_criteria.html">Infill Criteria</a>
    </li>
    <li>
      <a href="../../articles/supplementary/machine_learning_with_mlrmbo.html">Machine learning with mlrMBO</a>
    </li>
    <li>
      <a href="../../articles/supplementary/human_in_the_loop_MBO.html">Human-in-the-loop MBO</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlrMBO">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Human-in-the-loop MBO</h1>
            
          </div>

    
    
<div class="contents">
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>This Vignette shows you how to use <strong>mlrMBO</strong> for a guided optimization. In this setting <strong>mlrMBO</strong> proposes a candidate configuration and you can then decide for yourself whether you want to evaluate it or another value. You have to evaluate the objective function manually. The value and the result have to be feed back to <strong>mlrMBO</strong>. Afterwards you can request the next candidate and so on.</p>
</div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Before we start the optimization you need to define the search space:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ps =<span class="st"> </span><span class="kw">makeParamSet</span>(
  <span class="kw">makeNumericParam</span>(<span class="st">"q"</span>, <span class="dt">lower =</span> -<span class="dv">1</span>, <span class="dt">upper =</span> <span class="dv">2</span>),
  <span class="kw">makeIntegerParam</span>(<span class="st">"v"</span>, <span class="dt">lower =</span> -<span class="dv">2</span>, <span class="dt">upper =</span> <span class="dv">3</span>)
)</code></pre></div>
<p>Furthermore we need an initial design that includes the results of the evaluated function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des =<span class="st"> </span><span class="kw">generateDesign</span>(<span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">par.set =</span> ps)
des
##             q  v
## 1  1.18696772  2
## 2 -0.61436073  0
## 3 -0.03739097 -1
## 4  1.58945409  3
## 5 -0.43089112  2
## 6  0.69478728 -2
## 7  1.09551685  1</code></pre></div>
<p>After evaluating the objective function manually we can add the results</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des$y =<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.20</span>, <span class="fl">0.97</span>, <span class="fl">0.91</span>, <span class="fl">3.15</span>, <span class="fl">0.58</span>, <span class="fl">1.12</span>, <span class="fl">0.50</span>)</code></pre></div>
<p>Now we define our <strong>mlrMBO</strong>-Control object. For this example we stick to the defaults except that we set the infill-criterion to the <strong>Expected Improvement</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span>()
ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> crit.ei)</code></pre></div>
<p>These information are enough to get us started and initialize the sequential MBO.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opt.state =<span class="st"> </span><span class="kw"><a href="../../reference/initSMBO.html">initSMBO</a></span>(<span class="dt">par.set =</span> ps, <span class="dt">design =</span> des, <span class="dt">control =</span> ctrl, <span class="dt">minimize =</span> <span class="ot">TRUE</span>, <span class="dt">noisy =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>At each state the <code>opt.state</code> object can be plotted to visualize the predictions of the surrogate model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(opt.state)
## Loading required package: rgenoud
## ##  rgenoud (Version 5.8-1.0, Build Date: 2017-10-10)
## ##  See http://sekhon.berkeley.edu/rgenoud for additional documentation.
## ##  Please cite software as:
## ##   Walter Mebane, Jr. and Jasjeet S. Sekhon. 2011.
## ##   ``Genetic Optimization Using Derivatives: The rgenoud package for R.''
## ##   Journal of Statistical Software, 42(11): 1-26. 
## ##</code></pre></div>
<p><img src="human_in_the_loop_MBO_files/figure-html/plotOptState1-1.svg" width="672"></p>
<p>The first panel shows the value of the infill criterion. The higher the value the more this area is desirable to be explored to find the optimum. In the following panels the mean prediction of the surrogate and the uncertainty estimation is plotted.</p>
<p>Let’s see which point MBO suggests we should evaluate in the next step:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state)
## $prop.points
##            q  v
## 150 1.011225 -1
## 
## $propose.time
## [1] 0.223
## 
## $prop.type
## [1] "infill_ei"
## 
## $crit.vals
##            [,1]
## [1,] -0.2222111
## 
## $crit.components
##          se      mean
## 1 0.4272983 0.4049185
## 
## $errors.model
## [1] NA
## 
## attr(,"class")
## [1] "Proposal" "list"</code></pre></div>
<p>We don’t have to stick to the suggestion and evaluate another point:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">q =</span> <span class="fl">1.7</span>, <span class="dt">v =</span> <span class="dv">1</span>)</code></pre></div>
<p>After we evaluated the objective function manually we get a return value of <code>2.19</code>. We take both values to update MBO:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/updateSMBO.html">updateSMBO</a></span>(opt.state, <span class="dt">x =</span> x, <span class="dt">y =</span> <span class="fl">2.19</span>)</code></pre></div>
<p>Now we can plot the state again and ask for a proposal:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(opt.state)</code></pre></div>
<p><img src="human_in_the_loop_MBO_files/figure-html/plotOptState2-1.svg" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">prop =</span> <span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state))
## $prop.points
##             q v
## 941 0.9937339 0
## 
## $propose.time
## [1] 0.108
## 
## $prop.type
## [1] "infill_ei"
## 
## $crit.vals
##            [,1]
## [1,] -0.1836443
## 
## $crit.components
##          se      mean
## 1 0.3871173 0.4447291
## 
## $errors.model
## [1] NA
## 
## attr(,"class")
## [1] "Proposal" "list"</code></pre></div>
<p>This time we evaluated the exact proposed points and get a value of <code>0.13</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/updateSMBO.html">updateSMBO</a></span>(opt.state, <span class="dt">x =</span> prop$prop.points, <span class="dt">y =</span> <span class="fl">0.13</span>)</code></pre></div>
<p>Let’s assume we want to stop here. To get to the usual MBO result you can call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw"><a href="../../reference/finalizeSMBO.html">finalizeSMBO</a></span>(opt.state)
res$x
## $q
## [1] 0.9937339
## 
## $v
## [1] 0
res$y
## [1] 0.13</code></pre></div>
<div id="semi-automatic-mbo" class="section level3">
<h3 class="hasAnchor">
<a href="#semi-automatic-mbo" class="anchor"></a>Semi Automatic MBO</h3>
<p>You can combine the human-in-the-loop MBO with a simple loop to let MBO run for a while and just interfere once in a while.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f =<span class="st"> </span>function(q, v) <span class="dv">1</span> +<span class="st"> </span><span class="kw">sin</span>(q*<span class="dv">5</span>) +<span class="st"> </span><span class="fl">0.1</span> *<span class="st"> </span>(q^<span class="dv">2</span> +<span class="st"> </span>v^<span class="dv">2</span>)
for (i in <span class="dv">1</span>:<span class="dv">10</span>) {
  prop =<span class="st"> </span><span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state)
  x =<span class="st"> </span><span class="kw">dfRowsToList</span>(<span class="dt">df =</span> prop$prop.points, <span class="dt">par.set =</span> ps)
  y =<span class="st"> </span><span class="kw">do.call</span>(f, x[[<span class="dv">1</span>]])
  <span class="kw"><a href="../../reference/updateSMBO.html">updateSMBO</a></span>(opt.state, <span class="dt">x =</span> prop$prop.points, <span class="dt">y =</span> y)
}
<span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state)
## $prop.points
##              q v
## 387 -0.3000646 0
## 
## $propose.time
## [1] 0.113
## 
## $prop.type
## [1] "infill_ei"
## 
## $crit.vals
##              [,1]
## [1,] -0.002831849
## 
## $crit.components
##            se       mean
## 1 0.009017027 0.01173291
## 
## $errors.model
## [1] NA
## 
## attr(,"class")
## [1] "Proposal" "list"</code></pre></div>
</div>
</div>
<div id="continue-a-normal-mbo-run" class="section level2">
<h2 class="hasAnchor">
<a href="#continue-a-normal-mbo-run" class="anchor"></a>Continue a normal MBO Run</h2>
<p>You can also continue a normal call of <code><a href="../../reference/mbo.html">mbo()</a></code> using this manual interface:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fun =<span class="st"> </span><span class="kw">makeAlpine02Function</span>(<span class="dv">1</span>)
res =<span class="st"> </span><span class="kw"><a href="../../reference/mbo.html">mbo</a></span>(<span class="dt">fun =</span> fun, <span class="dt">control =</span> ctrl)
## Computing y column(s) for design. Not provided.
## [mbo] 0: x=2.9 : y = 0.404 : 0.0 secs : initdesign
## [mbo] 0: x=0.95 : y = 0.793 : 0.0 secs : initdesign
## [mbo] 0: x=9.8 : y = -1.14 : 0.0 secs : initdesign
## [mbo] 0: x=5.7 : y = -1.32 : 0.0 secs : initdesign
## [mbo] 1: x=1.62e-05 : y = 6.5e-08 : 0.0 secs : infill_ei
## [mbo] 2: x=1.63 : y = 1.27 : 0.0 secs : infill_ei
## [mbo] 3: x=1.89 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 4: x=1.79 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 5: x=1.84 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 6: x=2.03 : y = 1.28 : 0.0 secs : infill_ei
## [mbo] 7: x=1.82 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 8: x=1.86 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 9: x=1.83 : y = 1.31 : 0.0 secs : infill_ei
## [mbo] 10: x=1.84 : y = 1.31 : 0.0 secs : infill_ei
opt.state =<span class="st"> </span>res$final.opt.state
<span class="kw">plot</span>(opt.state, <span class="dt">scale.panels =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="human_in_the_loop_MBO_files/figure-html/continue%20mbo-1.svg" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">prop =</span> <span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state))
## $prop.points
##            x
## 487 1.836319
## 
## $propose.time
## [1] 0.08
## 
## $prop.type
## [1] "infill_ei"
## 
## $crit.vals
##               [,1]
## [1,] -4.518056e-05
## 
## $crit.components
##             se     mean
## 1 0.0001131826 1.307619
## 
## $errors.model
## [1] NA
## 
## attr(,"class")
## [1] "Proposal" "list"
y =<span class="st"> </span><span class="kw">fun</span>(prop$prop.points)
<span class="kw"><a href="../../reference/updateSMBO.html">updateSMBO</a></span>(opt.state, <span class="dt">x =</span> prop$prop.points, <span class="dt">y =</span> y)
<span class="co"># ...</span></code></pre></div>
</div>
<div id="proposal-of-multiple-points" class="section level2">
<h2 class="hasAnchor">
<a href="#proposal-of-multiple-points" class="anchor"></a>Proposal of multiple points</h2>
<p>Using Multi-Point MBO you can also obtain multiple suggestions at each call of <code><a href="../../reference/proposePoints.html">proposePoints()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span>(<span class="dt">propose.points =</span> <span class="dv">4</span>)
ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> <span class="kw"><a href="../../reference/infillcrits.html">makeMBOInfillCritEI</a></span>())
ctrl =<span class="st"> </span><span class="kw"><a href="../../reference/setMBOControlMultiPoint.html">setMBOControlMultiPoint</a></span>(ctrl, <span class="dt">method =</span> <span class="st">"cl"</span>)
opt.state =<span class="st"> </span><span class="kw"><a href="../../reference/initSMBO.html">initSMBO</a></span>(<span class="dt">par.set =</span> ps, <span class="dt">design =</span> des, <span class="dt">control =</span> ctrl, <span class="dt">minimize =</span> <span class="ot">TRUE</span>, <span class="dt">noisy =</span> <span class="ot">FALSE</span>)
(<span class="dt">prop =</span> <span class="kw"><a href="../../reference/proposePoints.html">proposePoints</a></span>(opt.state))
## $prop.points
##               q v
## 844 -0.92029797 1
## 642  0.07998039 1
## 963 -0.99995339 2
## 447  1.99999879 0
## 
## $propose.time
## [1] 0.099 0.094 0.097 0.102
## 
## $prop.type
## [1] "infill_ei" "infill_ei" "infill_ei" "infill_ei"
## 
## $crit.vals
##             [,1]
## [1,] -0.24670322
## [2,] -0.14032897
## [3,] -0.07620927
## [4,] -0.05269038
## 
## $crit.components
##          se      mean
## 1 0.4996289 0.4114801
## 2 0.1836356 0.3909594
## 3 0.1156264 0.4487536
## 4 0.4739049 0.8999264
## 
## $errors.model
## [1] NA NA NA NA
## 
## attr(,"class")
## [1] "Proposal" "list"</code></pre></div>
<p>It’s also okay to just evaluate a subset of these points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/updateSMBO.html">updateSMBO</a></span>(opt.state, <span class="dt">x =</span> prop$prop.points[<span class="dv">1</span>:<span class="dv">2</span>,], <span class="dt">y =</span> <span class="kw">list</span>(<span class="fl">2.28</span>, <span class="fl">1.67</span>))
<span class="co"># ...</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#continue-a-normal-mbo-run">Continue a normal MBO Run</a></li>
      <li><a href="#proposal-of-multiple-points">Proposal of multiple points</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bernd Bischl, Jakob Bossek, Jakob Richter, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
